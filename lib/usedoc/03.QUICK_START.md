# å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿé›†æˆ

### 1ï¸âƒ£ åŸºç¡€è®¤è¯é›†æˆ

```bash
# 1. å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶
cp -r modular-architecture/src/core/ your-project/src/types/
cp -r modular-architecture/src/auth/ your-project/src/auth/

# 2. å®‰è£…ä¾èµ–
npm install @supabase/supabase-js

# 3. ç¯å¢ƒé…ç½®
echo "SUPABASE_URL=your_url" >> .env.local
echo "SUPABASE_ANON_KEY=your_key" >> .env.local

# 4. ä½¿ç”¨ä»£ç 
```

```typescript
// your-project/src/app.ts
import { getAuth } from '@/auth';

async function login(email: string, password: string) {
  const auth = getAuth(); // è‡ªåŠ¨æ£€æµ‹åŒºåŸŸ
  return await auth.signInWithEmail(email, password);
}
```

---

### 2ï¸âƒ£ æ”¯ä»˜åŠŸèƒ½é›†æˆ

```bash
# 1. å¤åˆ¶æ”¯ä»˜æ¨¡å—
cp -r modular-architecture/src/payment/ your-project/src/payment/
cp -r modular-architecture/src/utils/ your-project/src/utils/

# 2. å®‰è£…æ”¯ä»˜ä¾èµ–
npm install stripe

# 3. é…ç½®Stripe
echo "STRIPE_SECRET_KEY=sk_test_..." >> .env.local
echo "STRIPE_PUBLIC_KEY=pk_test_..." >> .env.local
```

```typescript
// your-project/src/payment.ts
import { PaymentRouter } from '@/payment';

const paymentRouter = new PaymentRouter();

export async function createPayment(amount: number) {
  const order = {
    amount,
    currency: 'USD',
    description: 'Product purchase',
    userId: 'user123',
    planType: 'premium',
    billingCycle: 'monthly'
  };

  return await paymentRouter.createPayment(RegionType.USA, order);
}
```

---

### 3ï¸âƒ£ å®Œæ•´æ¶æ„é›†æˆ

```bash
# 1. å¤åˆ¶æ‰€æœ‰æ¨¡å—
cp -r modular-architecture/src/ your-project/src/

# 2. å®‰è£…æ‰€æœ‰ä¾èµ–
npm install @supabase/supabase-js stripe @cloudbase/node-sdk

# 3. å¤åˆ¶é…ç½®æ–‡ä»¶
cp modular-architecture/jest.config.js your-project/
cp modular-architecture/package.json your-project/package.json

# 4. ç¯å¢ƒé…ç½®
```

```typescript
// your-project/src/index.ts
import { quickStart, healthCheck } from './factory';

async function startApp() {
  // å¿«é€Ÿå¯åŠ¨ - é€‰æ‹©é¢„è®¾é…ç½®
  const app = process.env.REGION === 'INTL'
    ? quickStart.international()
    : quickStart.china();

  // å¥åº·æ£€æŸ¥
  const health = await healthCheck(app);
  if (!health.healthy) {
    console.error('âŒ æ¶æ„å¥åº·æ£€æŸ¥å¤±è´¥:', health.checks);
    return;
  }

  console.log('âœ… åº”ç”¨å¯åŠ¨æˆåŠŸ!');
  console.log('ğŸŒ åŒºåŸŸ:', app.config.region);

  return app;
}

// å¯åŠ¨åº”ç”¨
startApp().catch(console.error);
```

---

## ğŸ¯ ä¸åŒåœºæ™¯çš„æ¨¡æ¿

### åœºæ™¯1: ä¸­å›½åŒºç”µå•†åº”ç”¨

```typescript
import { quickStart } from '@/factory';

const chinaApp = quickStart.china();

// ç”¨æˆ·è®¤è¯
async function registerUser(email: string, password: string) {
  return await chinaApp.auth.signUpWithEmail(email, password);
}

// åˆ›å»ºè®¢å•
async function createOrder(amount: number) {
  const order = {
    amount,
    currency: 'CNY',
    description: 'å•†å“è´­ä¹°',
    userId: 'user123',
    planType: 'product',
    billingCycle: 'monthly'
  };

  // è‡ªåŠ¨ä½¿ç”¨æ”¯ä»˜å®/å¾®ä¿¡æ”¯ä»˜
  return await chinaApp.payment.createPayment(RegionType.CHINA, order);
}

// åœ°ç†æ£€æµ‹
async function getUserLocation(ip: string) {
  return await chinaApp.geo.detect(ip);
}
```

### åœºæ™¯2: å›½é™…SaaSåº”ç”¨

```typescript
import { quickStart } from '@/factory';

const intlApp = quickStart.international();

// è®¢é˜…ç®¡ç†
async function createSubscription(plan: string) {
  const order = {
    amount: 99.99,
    currency: 'USD',
    description: `${plan} subscription`,
    userId: 'user123',
    planType: plan,
    billingCycle: 'monthly'
  };

  // è‡ªåŠ¨ä½¿ç”¨Stripe/PayPal
  return await intlApp.payment.createPayment(RegionType.USA, order);
}

// GDPRåˆè§„
if (intlApp.compliance) {
  const consentModal = intlApp.compliance.generateConsentModal('en');
  // æ˜¾ç¤ºåŒæ„ä¹¦æ¨¡æ€æ¡†
}

// ç”¨æˆ·æ•°æ®ç®¡ç†
async function saveUserData(data: any) {
  // GDPRåˆè§„æ•°æ®å¤„ç†
  if (intlApp.compliance) {
    data = intlApp.compliance.anonymizeUserData(data);
  }

  const db = intlApp.database.getClient();
  return await db.from('users').insert(data);
}
```

### åœºæ™¯3: å…¨çƒåŒ–å†…å®¹å¹³å°

```typescript
import { createModularArchitecture } from '@/factory';

const globalApp = createModularArchitecture({
  region: DeploymentRegion.INTL,
  enableGDPR: true,
  autoInitialize: true
});

// å¤šåŒºåŸŸå†…å®¹åˆ†å‘
async function getContent(userIP: string) {
  const location = await globalApp.geo.detect(userIP);

  if (location.region === RegionType.EUROPE) {
    // æ¬§æ´²ç”¨æˆ· - éœ€è¦GDPRåˆè§„
    if (globalApp.compliance) {
      const consent = await showConsentModal();
      if (!consent) {
        throw new Error('éœ€è¦GDPRåŒæ„');
      }
    }
  }

  // è¿”å›åŒºåŸŸåŒ–å†…å®¹
  return getContentByRegion(location.region);
}

// ç»Ÿä¸€ç”¨æˆ·è®¤è¯
async function authenticateUser(provider: 'google' | 'email' | 'wechat', credentials: any) {
  switch (provider) {
    case 'google':
      return await globalApp.auth.signInWithOAuth('google');
    case 'email':
      return await globalApp.auth.signInWithEmail(credentials.email, credentials.password);
    case 'wechat':
      // ä¸­å›½ç”¨æˆ·ç‰¹æ®Šå¤„ç†
      if (await isInChina()) {
        return await globalApp.auth.signInWithWeChat(credentials.code);
      }
    default:
      throw new Error('ä¸æ”¯æŒçš„è®¤è¯æ–¹å¼');
  }
}
```

## ğŸ”§ å¿…éœ€çš„ç¯å¢ƒé…ç½®

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
# åŸºç¡€é…ç½®
NEXT_PUBLIC_DEPLOYMENT_REGION=CN  # æˆ– INTL
NODE_ENV=development

# æ•°æ®åº“é…ç½® (äºŒé€‰ä¸€)
# Supabase (å›½é™…æ¨è)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your_anon_key

# CloudBase (ä¸­å›½æ¨è)
WECHAT_CLOUDBASE_ID=your_cloudbase_id
CLOUDBASE_SECRET_ID=your_secret_id
CLOUDBASE_SECRET_KEY=your_secret_key

# è®¤è¯é…ç½®
WECHAT_APP_ID=your_wechat_app_id
WECHAT_APP_SECRET=your_wechat_app_secret

# æ”¯ä»˜é…ç½® (æŒ‰éœ€)
# Stripe
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLIC_KEY=pk_test_...

# PayPal
PAYPAL_CLIENT_ID=your_client_id
PAYPAL_CLIENT_SECRET=your_client_secret

# æ”¯ä»˜å®
ALIPAY_APP_ID=your_alipay_app_id
ALIPAY_PRIVATE_KEY=your_private_key
```

## ğŸ“¦ Package.json ä¾èµ–

```json
{
  "dependencies": {
    "@supabase/supabase-js": "^2.0.0",
    "@cloudbase/node-sdk": "^2.0.0",
    "stripe": "^14.0.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "jest": "^29.0.0",
    "@types/jest": "^29.0.0",
    "ts-jest": "^29.0.0",
    "typescript": "^5.0.0"
  },
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "test": "jest",
    "test:watch": "jest --watch",
    "health": "node -e \"require('./src/factory').healthCheck(require('./src/factory').quickStart.china()).then(console.log)\""
  }
}
```

## ğŸ§ª æµ‹è¯•ä½ çš„é›†æˆ

```typescript
// your-project/src/test-integration.ts
import { quickStart } from '@/factory';

async function testIntegration() {
  console.log('ğŸ§ª å¼€å§‹é›†æˆæµ‹è¯•...');

  try {
    // 1. åˆ›å»ºæ¶æ„å®ä¾‹
    const app = quickStart.china();
    console.log('âœ… æ¶æ„åˆ›å»ºæˆåŠŸ');

    // 2. å¥åº·æ£€æŸ¥
    const health = await healthCheck(app);
    if (!health.healthy) {
      console.log('âŒ å¥åº·æ£€æŸ¥å¤±è´¥:', health.checks);
      return;
    }
    console.log('âœ… å¥åº·æ£€æŸ¥é€šè¿‡');

    // 3. æµ‹è¯•åœ°ç†è·¯ç”±
    const geoResult = await app.geo.detect('8.8.8.8');
    console.log('âœ… åœ°ç†æ£€æµ‹:', geoResult.countryCode);

    // 4. æµ‹è¯•è®¤è¯
    try {
      const authResult = await app.auth.isAuthenticated();
      console.log('âœ… è®¤è¯æ¨¡å—æ­£å¸¸');
    } catch (error) {
      console.log('âš ï¸  è®¤è¯æ¨¡å—éœ€è¦é…ç½®');
    }

    // 5. æµ‹è¯•æ”¯ä»˜é…ç½®
    const paymentMethods = app.payment.getAvailableMethods(RegionType.CHINA);
    console.log('âœ… æ”¯ä»˜æ–¹å¼:', paymentMethods);

    console.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼');

  } catch (error) {
    console.error('âŒ æµ‹è¯•å¤±è´¥:', error);
  }
}

// è¿è¡Œæµ‹è¯•
testIntegration();
```

## ğŸ†˜ å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### é—®é¢˜1: æ¨¡å—å¯¼å…¥å¤±è´¥

```typescript
// é”™è¯¯
import { User } from '../core/types';

// è§£å†³æ–¹æ¡ˆ - é…ç½®tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}

// æ­£ç¡®å¯¼å…¥
import { User } from '@/types';
```

### é—®é¢˜2: ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

```bash
# ç¡®ä¿æ–‡ä»¶åæ­£ç¡®
.env.local  # âœ… æ­£ç¡®
.env        # âš ï¸  å¯èƒ½è¢«gitå¿½ç•¥

# é‡å¯å¼€å‘æœåŠ¡å™¨
npm run dev
```

### é—®é¢˜3: Supabaseè¿æ¥å¤±è´¥

```typescript
// æ£€æŸ¥è¿æ¥
import { createDatabaseConnector } from '@/database';

async function testConnection() {
  try {
    const db = createDatabaseConnector('supabase', {
      url: process.env.SUPABASE_URL,
      anonKey: process.env.SUPABASE_ANON_KEY
    });

    await db.initialize();
    const isHealthy = await db.testConnection();
    console.log('æ•°æ®åº“è¿æ¥:', isHealthy ? 'âœ…' : 'âŒ');
  } catch (error) {
    console.error('è¿æ¥é”™è¯¯:', error.message);
  }
}
```

### é—®é¢˜4: æ”¯ä»˜æ¨¡å—é”™è¯¯

```typescript
// æ£€æŸ¥æ”¯ä»˜é…ç½®
import { isPaymentMethodAvailable } from '@/payment';

console.log('æ”¯ä»˜å®å¯ç”¨:', isPaymentMethodAvailable('alipay', 'CN'));
console.log('Stripeå¯ç”¨:', isPaymentMethodAvailable('stripe', 'INTL'));
```

## ğŸ¯ ä¸‹ä¸€æ­¥

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸé›†æˆäº†æ¨¡å—åŒ–æ¶æ„ã€‚æ¥ä¸‹æ¥å¯ä»¥ï¼š

1. **é˜…è¯»å®Œæ•´æ–‡æ¡£**: `REUSE_GUIDE.md`
2. **æŸ¥çœ‹ç¤ºä¾‹ä»£ç **: `src/` ç›®å½•ä¸‹çš„å„ä¸ªæ¨¡å—
3. **è¿è¡Œæµ‹è¯•**: `npm test`
4. **æŸ¥çœ‹APIæ–‡æ¡£**: å„æ¨¡å—çš„TypeScriptç±»å‹å®šä¹‰
5. **å¼€å§‹å¼€å‘**: ä½¿ç”¨ `quickStart()` å¿«é€Ÿå¯åŠ¨é¡¹ç›®

éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹ `REUSE_GUIDE.md` è·å–è¯¦ç»†çš„å¤ç”¨æŒ‡å—ï¼